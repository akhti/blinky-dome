/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.0/userguide/tutorial_java_projects.html
 */

// Build fatjars (bundle all dependencies into single executable jar)
buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:2.0.0'
    }
}

apply plugin: 'com.github.johnrengelman.shadow'

apply plugin: 'java'

apply plugin: 'application'

repositories {
    mavenCentral()
}

jar {
    manifest {
        attributes("Implementation-Title": "blinky-dome",
                "Implementation-Version": "1.0",
                "Main-Class": "com.github.starcats.blinkydome.AppGui")
    }
}


dependencies {

    compile project(':lib:lx')
    compile project(':lib:p3lx')
    compile project(':lib:minim')

    compile files('lib/PixelPusher.jar')
    compile files('lib/apa102-java-rpi-lib-1.0-all.jar')

    //compile 'com.google.guava:guava:21.0'

    // https://mvnrepository.com/artifact/org.processing/core
    compile group: 'org.processing', name: 'core', version: '3.3.5'

    // Processing maven repo is missing jogl native jars.  They're brought in with the jogl-all-main
    runtime group: 'org.jogamp.jogl', name: 'jogl-all-main', version: '2.3.2'


    // Use JUnit test framework
    testCompile 'junit:junit:4.12'
}


// Define the main class for the application (default is GuiApp)
mainClassName = 'com.github.starcats.blinkydome.AppGui'


// Create configurations for AppHeadless
// -------------

// Application plugin: just run AppHeadless
task headlessRun(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath
    main = 'com.github.starcats.blinkydome.AppHeadless'
}

// Builds a shadow jar with AppHeadless
// (see https://github.com/johnrengelman/shadow/issues/108 )
task headlessShadowJar(type: com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar) {
    manifest.attributes 'Main-Class': 'com.github.starcats.blinkydome.AppHeadless'
    group = "shadow"
    description = "Headless blinky-dome"
    classifier = 'headless-all'
    from(project.convention.getPlugin(JavaPluginConvention).sourceSets.main.output)
    configurations = [project.configurations.runtime]
    exclude('META-INF/INDEX.LIST', 'META-INF/*.SF', 'META-INF/*.DSA', 'META-INF/*.RSA')

    // AppHeadless shouldn't be using any p3lx stuff, so exclude it from shadowjar
    // TODO: Still have a few headless config dependencies on p3lx stuff... should clean that up.
//    dependencies {
//        exclude(project(':lib:p3lx'))
//    }
}

// AppHeadless Unused: these (should?) do Application plugin distributions with AppHeadless, but since we use shadowJar,
// we don't really care about those distros

//Create start script for AppHeadless
//task headlessStartScript(type:CreateStartScripts) {
//    applicationName = 'blinky-dome-headless'
//    classpath = startScripts.classpath
//    outputDir = startScripts.outputDir
//    mainClassName = 'com.github.starcats.blinkydome.AppHeadless'
//}
//
//applicationDistribution.into("bin") {
//    from(headlessStartScript)
//    fileMode = 0755
//}